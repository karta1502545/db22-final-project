package org.vanilladb.core.featurecollect;

import java.util.Map;
import java.util.HashMap;

public class FeatureMap {
	private HashMap<int, FeatureCollection> featureMap = new HashMap<Integer, FeatureCollection>();
    public FeatureCollection getFeature(int txNum) {
        return featureMap.get(txNum);
    }
    public void setFeature(int txNum, FeatureCollection feature) {
        featureMap.put(txNum, feature);
    }
    public void outputFeatureMapAsCSV() {
        String LINE_SEPARATOR = System.getProperty("line.separator", "\n");

        PrintWriter pw = null;
        try {
            pw = new PrintWriter(new File("Features.csv"));
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        }
        StringBuilder buff = new StringBuilder();
        buff.append("txNum,startTime,readCount,
                     writeCount,queryType,concurrentlyExecutingTxNum,
                     accessedTableNum").append(LINE_SEPARATOR);
        for (FeatureCollection txFeature : featureMap.values()) {
            buff.append(txFeature.txNum).append(",")
                .append(txFeature.startTime).append(",")
                .append(txFeature.readCount).append(",")
                .append(txFeature.writeCount).append(",")
                .append(txFeature.queryType).append(",")
                .append(txFeature.concurrentlyExecutingTxNum).append(",")
                .append(txFeature.accessedTableNum).append(",");
                .append(LINE_SEPARATOR);
        }
        pw.write(buff.toString());
        pw.close();
        System.out.println("Features of each transaction are successfully written in Feature.csv!");
    }
}